<html>

<head id="h1">
    <meta id="me" name="viewport" content="width=device-width">
</head>

<style id="s1">
    body {
        text-align: center;
    }
    #todo {
        display: none;
    }
    body {
        // text-align: center;
        font-size: 15px;
        margin: 20px;
        background: white;
    }
    code# {
        margin: 5%;
        width: 10%;
        position: absolute;
        bottom: 2%;
        right: 1%;
    }
    button {
        width: 40%;
        font-size: 15px;
        border-radius: 10px;
        background: rgb(245, 2, 14);
        margin: 30px;
        color: white;
    }
    #reader {
        width: 100%;
        color: white;
        font-size: 15px;
    }
    #ta {
        width: 95%;
        display: none;
    }
    #tx {
        margin: 5%;
        width: 90%;
        font-size: 15px;
        height: 20%;
        background-color: turquoise;
    }
    .c2 {
        display: grid;
        grid-column-gap: 30px;
        // grid-template-columns: auto;
        grid-template-columns: 80%;
        background-color: white;
        padding: 30px;
    }
    .grid-container {
     
        width: 100%;
        display: grid;
        grid-column-gap: 5%;
        // grid-template-columns: auto auto auto;
        grid-template-columns: 45% 45%;
        background-color: white;
        padding: 8px;
        font-size: 18px;
        font-weight: bold;
        
    }
    .grid-item {
        height: 50px;
        margin: 15px;
        border: .5px solid rgba(0, 0, 0, 0.8);
        padding: 12px;
        text-align: right;
    }
    .cdt {
        border-style: solid;
        height: 5%;
        width: 30%;
        background-color: green;
    }
    .cimg {
        width: 50px;
        height: 50px;
    }
    .cpn {
        width: 50%;
        background-color: white;
        font-weight: bold;
        font-size: 20px;
        margin: 5px;
    }
    .cbq {
        margin: 5px;
        color: white;
        background-color: black;
    }
    .cadj {
        width: 25%;
        z-index: 1;
    }
    #bsh{
        position: absolute;
        top:0%;
        right:0%;
        width: auto;
    }
    #menu{
        width: 90%;
        padding: 30px;
        position: absolute;
        top:30%;
        left:3%;
        display: none;
        border-style: double;;
        border-color: white;
        background-color: rgba(10, 148, 179, 0.3);
        z-index: 5;
        box-shadow: -10px 10px 50px 1px  black;
    }
    
</style>
<div id="menu">
<input class="cadj" type="range" id="iwidth" name="w" min="0" max="400" value="100" oninput="sca(this.value,iheight.value)">
<label for="width">width</label>

<input class="cadj" type="range" id="iheight" name="h" min="0" max="400" value="100" step="1" oninput="sca(iwidth.value,this.value)">
<label for="height">Height</label>


<input class="cadj" type="range" id="ifon" name="fon" min="0" max="80" value="20" step="1" oninput="tags.style.fontSize=this.value+'px'">
<label for="fon">Font</label>
<br>
<button id="brecover" onclick="recover()">Recover</button>
<button id="brecover" onclick="copyCl()">Copy</button>
<button id="btprep" onclick="readySc()">Prepare</button>
<button id="showall" onclick="showAll()">Reset All</button>
</div>
<br>
<br><br>
<br>
<div class="grid-container" id="tags">
</div>


<br>
<br><button id="bsh" onclick="if(menu.style.display==='block'){menu.style.display='none'}else{ menu.style.display='block';}">Menu</button>

<br>
<br>
<br>
<br>
<script src="html5-qrcode.min.js"></script>
<script src=""></script>

<script>
    var R = 11 / 8.5;
    // alert(s1.innerHTML)
    tags.style.gridIemplateColumns = "10% 10% 10%"
    var linkp = 'https://jsonblob.com/api/d0317ef4-f48e-11eb-9b1d-755fd0c1d5cb'
    var w = window.innerWidth;
    var h = window.innerHeight;
    var radio = h / w;
    if (radio > 1.1) {
        //         tags.removeClass();
        tags.setAttribute("class", "c2")
    } else {}



    function loadDoc(url, callback) {
        var xhttp = new XMLHttpRequest();
        xhttp.open("GET", url, false);
        xhttp.send();
        callback(xhttp.responseText);

    }
    var cont = ""
    setTags()

    function setTags() {

        var w = window.innerWidth;
        var h = window.innerHeight;

        for (var i = 0; i < 18; i++) {
                 tags.appendChild(crTag())       }
        cont = tags.innerHTML;
    }

    function crTag(ob) {
//alert("oh")
          var d=document.createElement("div");
          d.setAttribute("class","grid-item")
          
          d.setAttribute("onclick","sTag(this)")
          if(ob!=undefined){ 
              d.innerHTML=ob.pn+" _ ";
          d.setAttribute("id",ob.pn)
          d.value=ob.qty;
         
            d.name=ob.des;
    
    }
  //  alert("oh")
      var im=document.createElement("img");
      if(ob!=undefined) im.src=ob.url;
      im.setAttribute("class","cimg");
      d.appendChild(im);
      return d;

    }

    function readySc() {
        cont = tags.innerHTML;
        var tgs = tags.getElementsByTagName("div");
        for (var i = 0; i < tgs.length; i++) {
            if (tgs[i].value == "" || tgs[i].value == undefined) tgs[i].style.display = "none";

        }
    }

    function showAll() {
        tags.innerHTML = cont

    }

    function sTag(e) {
      //  alert(e.id)
        GetJ(linkp, function(obj) {
            var o = {};
            var pn = prompt("Part Number?",e.id);
            if (pn === null || pn === "" || pn === undefined) return
            var desc = prompt("Description?",e.name);
            var qty = prompt("Quantity?",e.value);
            qty = qty * 1;
            if (isNaN(qty)) return
            if (desc === null || desc === "" || desc === undefined) desc = "";;
       ///     if(desc!=e.name || aty !=e.value || 
      //      var tgs = tags.getElementsByTagName("div");

            var url = 'https://api.qrserver.com/v1/create-qr-code/?data=' + pn + ' ' + desc + '&amp;size=400x400';
                 o.pn = pn;
            o.des = desc;
            o.qty = qty;
            o.url = url;
            o.printed = false;
            o.created = new Date().toString();
            obj.parts.push(o);
       
            UpdateJ(linkp, obj, function() {});
      
      
          //  e.name=pn;
          // tgs[i].name=pn;
/*
            var si = '<img class="cimg" id="qr' + i + '" src="' + url + '"/>';
            e.value=pn + " " + desc;
           // tgs[i].value = pn + " " + desc;
           e.innerHTML=pn + " __ " + si;
           // tgs[i].innerHTML = pn + " __ " + si;
    
         */
        });


    }

    function recover() {
        tags.innerHTML = "";
           GetJ(linkp, function(obj) {
            for (var i = 0; i < obj.parts.length; i++) {
                var p = obj.parts[i];
                tags.appendChild(  crTag(p))
               }

        })

    }

    function copyCl() {

        GetJ(linkp, function(obj) {
            var ps = obj.parts;
            var so = ""
            var t = document.createElement("textarea");
            document.body.appendChild(t);

            for (var i = 0; i < ps.length; i++) {
                so += ps[i].qty + String.fromCharCode(9) + ps[i].pn + String.fromCharCode(9) + ps[i].des + "\n"
            }
            t.innerHTML = so;
            t.select();
            document.execCommand("copy");

            alert(so);
            document.body.removeChild(t)
        });
    }

    function sca(x, y) {
        // 
        x = x / 100;
        y = y / 100;
        tags.style.transform = 'scale(' + x + ',' + y + ')';
       tags.style.zIndex=-1
    }

    function GetJ(url, callback) {

        //var url  = "http://localhost:8080/api/v1/users";
        var xhr = new XMLHttpRequest()
        xhr.open('GET', url + '/1', true)
        xhr.onload = function() {
            //         (xhr.responseText)
            var users = JSON.parse(xhr.responseText);
            //     var obb=decoding(users.prim);

            if (xhr.readyState == 4 && xhr.status == "200") {
                callback(users);
            } else {
                console.error(users);
            }
        }
        xhr.send(null);
    }

    // Update a user
    function UpdateJ(url, ob, callback) {
        //   var o={};
        //   o.prim=encoding(ob);
        json = JSON.stringify(ob);
        var xhr = new XMLHttpRequest();
        xhr.open("PUT", url + '/12', true);
        xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');
        xhr.onload = function() {
            var users = JSON.parse(xhr.responseText);
            if (xhr.readyState == 4 && xhr.status == "200") {
                //  alert("Tu Forma ha sido Enviada");
                if (callback != undefined) callback(users);
            } else {
                (users);
            }
        }
        xhr.send(json);
    }
</script>

</html>
